<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>Microservice Architecture of Spring | Hexo</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="Spring" />
    
    <meta name="description" content="TDD가 개발자에게 좋은 이유여러 이유가 있지만 가장 중요한 점은 TDD로 요구사항에 대해 더 깊이 있게 생각할 수 있다는 점입니다. 테스트 코드를 먼저 작성하면 특정 상황에서 코드가 어떻게 동작할지 생각하게 됩니다. 이런 과정에서 애매한 요구사항은 명확히 하고, 유효하지 않은 요구사항은 거부할 수 있습니다. 곱셈 하는 예제 프로그램을 만들어 보자12345">
<meta property="og:type" content="article">
<meta property="og:title" content="Microservice Architecture of Spring">
<meta property="og:url" content="http://example.com/2021/11/13/2021-11-13-spring-msa/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="TDD가 개발자에게 좋은 이유여러 이유가 있지만 가장 중요한 점은 TDD로 요구사항에 대해 더 깊이 있게 생각할 수 있다는 점입니다. 테스트 코드를 먼저 작성하면 특정 상황에서 코드가 어떻게 동작할지 생각하게 됩니다. 이런 과정에서 애매한 요구사항은 명확히 하고, 유효하지 않은 요구사항은 거부할 수 있습니다. 곱셈 하는 예제 프로그램을 만들어 보자12345">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/res/2021-11-13-spring-msa/1.png">
<meta property="article:published_time" content="2021-11-13T02:38:54.000Z">
<meta property="article:modified_time" content="2022-04-15T00:49:03.417Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/res/2021-11-13-spring-msa/1.png">
    

    
        <link rel="alternate" href="/" title="Hexo" type="application/atom+xml" />
    

    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/titillium-web/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">


    
<script src="/libs/jquery/3.5.0/jquery.min.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


<meta name="generator" content="Hexo 6.1.0"></head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/1-Student/">1. Student</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/1-Student/Algorithm/">Algorithm</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/1-Student/Blog/">Blog</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/1-Student/Machine-learning/">Machine learning</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/1-Student/Project/">Project</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/1-Student/React/">React</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/">2. Interpark</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Algorithm/">Algorithm</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Blog/">Blog</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Cloud/">Cloud</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Computer-Science/">Computer Science</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Container/">Container</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Css/">Css</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Database/">Database</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Git/">Git</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Java/">Java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Maven/">Maven</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Network/">Network</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/React/">React</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Spring/">Spring</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/2-Interpark/Typescript/">Typescript</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/AWS/">AWS</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Ableton/">Ableton</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Blog/">Blog</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Database/">Database</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Docker/">Docker</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Facade/">Facade</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Flutter/">Flutter</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Git/">Git</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Gradle/">Gradle</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Hexo/">Hexo</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/JUnit/">JUnit</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Java/">Java</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Javascript/">Javascript</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Kotlin/">Kotlin</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Linux/">Linux</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Mac/">Mac</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Monitoring/">Monitoring</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/RabbitMQ/">RabbitMQ</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Redis/">Redis</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Spring/">Spring</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Vue/">Vue</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Web/">Web</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/3-Kakaobank/Webflux/">Webflux</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/4-Unfinished/">4. Unfinished</a></li></ul>
                                
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><i class="icon fa fa-angle-right"></i><a class="page-title-link" href="/categories/3-Kakaobank/Spring/">Spring</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <article id="post-2021-11-13-spring-msa" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        Microservice Architecture of Spring
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2021/11/13/2021-11-13-spring-msa/" class="article-date">
       <time datetime="2021-11-13T02:38:54.000Z" itemprop="datePublished">2021-11-13</time>
    </a>
  </div>


<div class="article-date">
  <i class="fa fa-calendar-plus-o"></i>
  <a href="/2021/11/13/2021-11-13-spring-msa/" class="article-date">
     <time datetime="2022-04-15T00:49:03.417Z" itemprop="dateModified">2022-04-15</time>
  </a>
</div>


                

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/Spring/" rel="tag">Spring</a>
    </div>

                

                

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            

            

            

            <h2 id="TDD가-개발자에게-좋은-이유"><a href="#TDD가-개발자에게-좋은-이유" class="headerlink" title="TDD가 개발자에게 좋은 이유"></a>TDD가 개발자에게 좋은 이유</h2><p>여러 이유가 있지만 가장 중요한 점은 TDD로 요구사항에 대해 더 깊이 있게 생각할 수 있다는 점입니다. 테스트 코드를 먼저 작성하면 특정 상황에서 코드가 어떻게 동작할지 생각하게 됩니다. 이런 과정에서 애매한 요구사항은 명확히 하고, 유효하지 않은 요구사항은 거부할 수 있습니다.</p>
<h2 id="곱셈-하는-예제-프로그램을-만들어-보자"><a href="#곱셈-하는-예제-프로그램을-만들어-보자" class="headerlink" title="곱셈 하는 예제 프로그램을 만들어 보자"></a>곱셈 하는 예제 프로그램을 만들어 보자</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Multiplication</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> factorA;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> factorB;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Multiplication</span><span class="params">(<span class="type">int</span> factorA, <span class="type">int</span> factorB)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factorA = factorA;</span><br><span class="line">        <span class="built_in">this</span>.factorB = factorB;</span><br><span class="line">        <span class="built_in">this</span>.result = factorA * factorB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFactorA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> factorA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getFactorB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> factorB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Multiplication&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;factorA=&quot;</span> + factorA +</span><br><span class="line">                <span class="string">&quot;, factorB=&quot;</span> + factorB +</span><br><span class="line">                <span class="string">&quot;, result(A*B)=&quot;</span> + result +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 두 개의 무작위 인수를 담은 &#123;<span class="doctag">@link</span> Multiplication&#125; 객체를 생성한다.</span></span><br><span class="line"><span class="comment">     * 무작위로 생성되는 숫자의 범위는 11~99</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 무작위 인수를 담은 &#123;<span class="doctag">@link</span> Multiplication&#125; 객체</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Multiplication <span class="title function_">createRandomMultiplication</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RandomGeneratorService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 무작위로 만든 11 이상 99 이하의 인수</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">generateRandomFactor</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>곱셈을 계산하는 서비스 (MultiplicationService) 내에서 숫자를 무작위로 생성한다면 테스트를 작성하기 어려워지기 때문에 RandomGeneratorService 인터페이스를 두어서 숫자 생성 부분만 따로 만드는 것입니다.</p>
<p>TDD 를 따르기 위해서 테스트 코드를 먼저 작성해보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultiplicationServiceTest</span> &#123;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> RandomGeneratorService randomGeneratorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MultiplicationService multiplicationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRandomMultiplicationTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given (randomGeneratorService가 처음에 50, 나중에 30을 반환하도록 설정)</span></span><br><span class="line">        given(randomGeneratorService.generateRandomFactor()).willReturn(<span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> multiplicationService.createRandomMultiplication();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// assert</span></span><br><span class="line">        assertThat(multiplication.getFactorA()).isEqualTo(<span class="number">50</span>);</span><br><span class="line">        assertThat(multiplication.getFactorB()).isEqualTo(<span class="number">30</span>);</span><br><span class="line">        assertThat(multiplication.getResult()).isEqualTo(<span class="number">1500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이 테스트에서 중요한건 @MockBean 입니다. 이 어노테이션은 스프링이 RandomGeneratorService 인터페이스에 맞는 구현 클래스를 찾아서 주입하는 대신 Mock 객체를 주입하는 것을 의미한다.</p>
<p>아직 MultiplicationService 의 구현체를 만들지 않았기 때문에 테스트 결과는 실패합니다. 이게 바로 TDD의 요점입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultiplicationServiceTest</span> &#123;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> RandomGeneratorService randomGeneratorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MultiplicationService multiplicationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRandomMultiplicationTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given (randomGeneratorService가 처음에 50, 나중에 30을 반환하도록 설정)</span></span><br><span class="line">        given(randomGeneratorService.generateRandomFactor()).willReturn(<span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> multiplicationService.createRandomMultiplication();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// assert</span></span><br><span class="line">        assertThat(multiplication.getFactorA()).isEqualTo(<span class="number">50</span>);</span><br><span class="line">        assertThat(multiplication.getFactorB()).isEqualTo(<span class="number">30</span>);</span><br><span class="line">        assertThat(multiplication.getResult()).isEqualTo(<span class="number">1500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="TDD의-이점을-정리해보자"><a href="#TDD의-이점을-정리해보자" class="headerlink" title="TDD의 이점을 정리해보자"></a>TDD의 이점을 정리해보자</h3><ul>
<li><p>테스트를 작성하면서 요구사항을 코드로 바꿀 수 있습니다. 요구사항을 살펴보면서 필요한 것과 필요하지 않은 것에 대해 생각해볼 수 있습니다. 지금까진 우리의 첫 번째 요구사항인 무작위로 곱셈을 생성하는 서비스만 있으면 됩니다.</p>
</li>
<li><p>테스트 가능한 코드를 만들게 됩니다. 구현하는 클래스를 먼저 작성하게 된다면 무작위 생성 로직을 그 안에 넣었을 가능성이 높고 그렇게 되면 그 이후에 테스트하기가 굉장히 어려워진다. 테스트 코드를 미리 작성한 덕에 테스트 코드를 더 작성하기 쉬운 구조로 구성할 수 있습니다.</p>
</li>
<li><p>중요한 로직에 초점을 맞추고 나머지는 나중에 구현할 수가 있습니다. 무작위 숫자 생성을 개발하고 테스트할 때 RandomGeneratorService 의 구현체를 작성할 필요가 없습니다.</p>
</li>
</ul>
<h3 id="SpringBootTest-를-남용하지-말자"><a href="#SpringBootTest-를-남용하지-말자" class="headerlink" title="@SpringBootTest 를 남용하지 말자."></a>@SpringBootTest 를 남용하지 말자.</h3><p>SpringRunner 와 @SpringBootTest 어노테이션은 애플리케이션 컨텍스트를 초기화하고 필요한 객체를 주입합니다. 다행이 컨텍스트는 캐싱이 되어 재사용이 가능해 테스트 당 한 번만 로딩됩니다. 그러나 여기 테스트 처럼 하나의 테스트만 필요할 때는 어플리케이션 컨텍스트를 초기화해서 사용하는 것 보다 그냥 해당 객체를 직접 구현해서 테스트하는 것이 보다 효율적입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomGeneratorServiceImplTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> RandomGeneratorServiceImpl randomGeneratorServiceImpl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        randomGeneratorServiceImpl = <span class="keyword">new</span> <span class="title class_">RandomGeneratorServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateRandomFactorIsBetweenExpectedLimits</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 무작위 숫자를 생성</span></span><br><span class="line">        List&lt;Integer&gt; randomFactors = IntStream.range(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">                .map(i -&gt; randomGeneratorServiceImpl.generateRandomFactor())</span><br><span class="line">                .boxed()</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 적당히 어려운 계산을 만들기 위해</span></span><br><span class="line">        <span class="comment">// 생성한 인수가 11~99 범위에 있는지 확인</span></span><br><span class="line">        assertThat(randomFactors).containsOnlyElementsOf(IntStream.range(<span class="number">11</span>, <span class="number">100</span>)</span><br><span class="line">                .boxed().collect(Collectors.toList()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RandomGeneratorServiceImpl 은 어플리케이션 컨텍스트를 불러오지 않고 바로 객체를 구현해서 테스트를 진행하였다. 위 테스트가 통과될 수 있도록 실제 소스 코드를 작성하자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomGeneratorServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RandomGeneratorService</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MINIMUM_FACTOR</span> <span class="operator">=</span> <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">MAXIMUM_FACTOR</span> <span class="operator">=</span> <span class="number">99</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">generateRandomFactor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt((MAXIMUM_FACTOR - MINIMUM_FACTOR) + <span class="number">1</span>) + MINIMUM_FACTOR;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MultiplicationServiceImplTest 에도 위처럼 어플리케이션 컨텍스트를 사용하지 않는 방식으로 테스트 코드를 추가해보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImplTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MultiplicationServiceImpl multiplicationServiceImpl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> RandomGeneratorService randomGeneratorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 목 객체를 초기화합니다.</span></span><br><span class="line">        MockitoAnnotations.initMocks(<span class="built_in">this</span>);</span><br><span class="line">        multiplicationServiceImpl = <span class="keyword">new</span> <span class="title class_">MultiplicationServiceImpl</span>(randomGeneratorService);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRandomMultiplicationTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given (목 객체가 처음에 50, 나중에 30 을 반환하도록 설정)</span></span><br><span class="line">        given(randomGeneratorService.generateRandomFactor()).willReturn(<span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> multiplicationServiceImpl.createRandomMultiplication();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// assert</span></span><br><span class="line">        assertThat(multiplication.getFactorA()).isEqualTo(<span class="number">50</span>);</span><br><span class="line">        assertThat(multiplication.getFactorB()).isEqualTo(<span class="number">30</span>);</span><br><span class="line">        assertThat(multiplication.getResult()).isEqualTo(<span class="number">1500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@MockBean 대신 @Mock 을 사용해 목 객체를 생성하였다. 어플리케이션 컨텍스트를 띄우지 않으니 빈을 사용하지 않기 때문이다.</p>
<h3 id="도메인은-설계하자"><a href="#도메인은-설계하자" class="headerlink" title="도메인은 설계하자"></a>도메인은 설계하자</h3><hr/>

<ul>
<li><p>Multiplication : 곱셈의 인수와 연산을 포함</p>
</li>
<li><p>User : 곱셈 문제를 푸는 사용자를 식별</p>
</li>
<li><p>MultiplicationResultAttempt : Multiplication 과 User 의 참조를 포함하고 사용자가 제출한 값과 채점 결과를 포함.</p>
</li>
</ul>
<hr/>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 애플리케이션에서 곱셈을 나타내는 클래스 (a * b)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Multiplication</span> &#123;</span><br><span class="line">    <span class="comment">// 두 인수</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> factorA;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> factorB;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON (역)직렬화를 위한 빈 생성자</span></span><br><span class="line">    Multiplication() &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 사용자 정보를 저장하는 클래스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String alias;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON (역)직렬화를 위한 빈 생성자</span></span><br><span class="line">    <span class="keyword">protected</span>  <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        alias = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttempt</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> User user;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Multiplication multiplication;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> resultAttempt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON (역)직렬화를 위한 빈 생성자</span></span><br><span class="line">    MultiplicationResultAttempt() &#123;</span><br><span class="line">        user = <span class="literal">null</span>;</span><br><span class="line">        multiplication = <span class="literal">null</span>;</span><br><span class="line">        resultAttempt = -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>이제 필요한 객체들의 책임 (= 비즈니스 로직) 을 생각해 봅시다. 요구사항을 고려해보면 앞으로 구현해야할 책임들은 아래와 같습니다.</p>
<hr/>

<ul>
<li><p>제출한 답안의 정답 여부 확인</p>
</li>
<li><p>적당히 어려운 곱셈 만들어내기</p>
</li>
</ul>
<hr/>

<p><em>‘제출한 답안의 정답 여부 확인’</em> 책임을 MultiplicationService 인터페이스에 넣고, 해당 책임을 테스트하는 코드를 작성합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 곱셈 계산 결과가 맞으면 true, 아니면 false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">checkAttempt</span><span class="params">(<span class="keyword">final</span> MultiplicationResultAttempt resultAttempt)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImplTest</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkCorrectAttemptTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">attemptResult</span> <span class="operator">=</span> multiplicationServiceImpl.checkAttempt(attempt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(attemptResult).isTrue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkWrongAttemptTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3010</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">attemptResult</span> <span class="operator">=</span> multiplicationServiceImpl.checkAttempt(attempt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(attemptResult).isFalse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>checkAttempt()</em> 가 원하는 동작을 하도록 구현합시다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAttempt</span><span class="params">(MultiplicationResultAttempt resultAttempt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> resultAttempt.getResultAttempt() ==</span><br><span class="line">                resultAttempt.getMultiplication().getFactorA() *</span><br><span class="line">                        resultAttempt.getMultiplication().getFactorB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>이제 REST API 를 만들어 봅시다 만들어야 할 API 는 아래와 같습니다.</p>
<hr/>

<ul>
<li><p>GET /multiplications/random : 무작위로 생성한 곱셈을 반환</p>
</li>
<li><p>POST /results/ : 결과를 전송하는 엔드포인트</p>
</li>
<li><p>GET /results?user=[user_alias] : 특정 사용자의 계산 결과를 검색</p>
</li>
</ul>
<hr/>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MultiplicationService multiplicationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MultiplicationController</span><span class="params">(<span class="keyword">final</span> MultiplicationService multiplicationService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.multiplicationService = multiplicationService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TDD 에 맞추어서 우선 컨트롤러 관련 테스트 코드를 먼저 작성하자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(MultiplicationController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationControllerTest</span> &#123;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> MultiplicationService multiplicationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 이 객체는 initFields() 메서드를 이용해 자동으로 초기화</span></span><br><span class="line">    <span class="keyword">private</span> JacksonTester&lt;Multiplication&gt; json;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        JacksonTester.initFields(<span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getRandomMultiplicationTest</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        given(multiplicationService.createRandomMultiplication())</span><br><span class="line">                .willReturn(<span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">70</span>, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">MockHttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> mvc.perform(</span><br><span class="line">                get(<span class="string">&quot;/multiplication/random&quot;</span>)</span><br><span class="line">                        .accept(MediaType.APPLICATION_JSON))</span><br><span class="line">                .andReturn().getResponse();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(response.getStatus()).isEqualTo(HttpStatus.OK.value());</span><br><span class="line">        assertThat(response.getContentAsString())</span><br><span class="line">                .isEqualTo(json.write(<span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">70</span>, <span class="number">20</span>)).getJson());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>아직 소스 코드 구현을 하지 않았기 때문에 테스트를 돌리면 실패할 것이다. 위 테스트 코드를 간단하게 살펴보면</p>
<ul>
<li><p>@WebMvcTest 는 @SpringBootTest 어노테이션과 동일하게 스프링 웹 어플리케이션 컨텍스트를 초기화합니다. 그러나 다른 점은 오직 MVC 레이어 (컨트롤러) 와 관련된 설정만 불러옵니다. 이 어노테이션은 MockMvc 빈도 불러옵니다.</p>
</li>
<li><p>JacksonTester 객체를 사용해 JSON 의 내용을 쉽게 확인할 수 있습니다. JacksonTester 객체는 자동으로 설정할 수 있고 @JsonTest 어노테이션을 이용해 자동으로 주입할 수 있습니다. 예제에서는 @WebMvcTest 어노테이션을 사용하기 때문에 수동으로 설정해야 합니다. (@Before 메서드 안에서 설정하고 있습니다)</p>
</li>
</ul>
<h2 id="WebMvcTest-와-SpringBootTest-의-차이"><a href="#WebMvcTest-와-SpringBootTest-의-차이" class="headerlink" title="@WebMvcTest 와 @SpringBootTest 의 차이"></a>@WebMvcTest 와 @SpringBootTest 의 차이</h2><p>@WebMvcTest 는 컨트롤러를 테스트하는 어노테이션입니다. HTTP 요청과 응답은 Mock 을 이용해 가짜로 이뤄지고 실제 연결은 생성되지 않습니다. 반면 @SpringBootTest 는 웹 어플리케이션 컨텍스트와 설정을 모두 불러와서 실제 웹 서버 연결을 시도합니다. 이런 경우에는 MockMvc 가 아니라 RestTemplate 혹은 TestRestTemplate 을 대신 사용하면 된다.</p>
<p>보통 @WebMvcTest 는 서버에서 컨트롤러만 테스트할 때 사용하고, @SpringBootTest 는 클라이언트부터 상호작용을 확인하는 통합 테스트에서 사용하는 것이 좋습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 곱셈 어플리케이션의 REST API 를 구현한 클래스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/random&quot;)</span></span><br><span class="line">    Multiplication <span class="title function_">getRandomMultiplication</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> multiplicationService.createRandomMultiplication();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MultiplicationResultAttemptController 구현 전 테스트 코드를 작성하자. 사용자가 보낸 답안이 맞을 경우와 틀릴 경우를 모두 테스트한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@WebMvcTest(MultiplicationResultAttemptController.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptControllerTest</span> &#123;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> MultiplicationService multiplicationService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JacksonTester&lt;MultiplicationResultAttempt&gt; jsonResult;</span><br><span class="line">    <span class="keyword">private</span> JacksonTester&lt;ResultResponse&gt; jsonResponse;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        JacksonTester.initFields(<span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postResultReturnCorrect</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        genericParameterizedTest(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postResultReturnNotCorrect</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        genericParameterizedTest(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">genericParameterizedTest</span><span class="params">(<span class="keyword">final</span> <span class="type">boolean</span> correct)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// given (지금 서비스를 테스트하는 것이 아님)</span></span><br><span class="line">        given(multiplicationService</span><br><span class="line">                .checkAttempt(any(MultiplicationResultAttempt.class)))</span><br><span class="line">                .willReturn(correct);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john&quot;</span>);</span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">70</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3500</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">MockHttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> mvc.perform(</span><br><span class="line">                post(<span class="string">&quot;/results&quot;</span>).contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                        .content(jsonResult.write(attempt).getJson()))</span><br><span class="line">                .andReturn().getResponse();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(response.getStatus()).isEqualTo(HttpStatus.OK.value());</span><br><span class="line">        assertThat(response.getContentAsString()).isEqualTo(</span><br><span class="line">                jsonResponse.write(<span class="keyword">new</span> <span class="title class_">ResultResponse</span>(correct)).getJson());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>비슷한 기능을 하는 부분을 뽑아서 genericParameterizedTest 메서드를 만들었다. 서비스는 결과가 맞는지 아닌지를 판단하고 맞으면 true, 아니면 false 를 반환합니다. 테스트 코드 작성이 완료되면 소스를 구현해보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/results&quot;)</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    ResponseEntity&lt;ResultResponse&gt; <span class="title function_">postResult</span><span class="params">(<span class="meta">@RequestBody</span> MultiplicationResultAttempt multiplicationResultAttempt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ResultResponse</span>(multiplicationService</span><br><span class="line">                        .checkAttempt(multiplicationResultAttempt)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>REST API 까지 완성했으니, 이제 기본적인 UI를 만들어 봅시다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Multiplication v1<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;multiplication-client.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>안녕하세요, 소셜 곱셈입니다!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>오늘의 문제:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;multiplication-a&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> x <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;multiplication-b&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> =</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;attempt-form&quot;</span>&gt;</span></span><br><span class="line">        답은? <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;result-attempt&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        닉네임: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user-alias&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;확인&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;result-message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: table-cell;</span><br><span class="line">    <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateMultiplication</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/multiplications/random&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="comment">// 폼 비우기</span></span><br><span class="line">        $(<span class="string">&quot;#attempt-form&quot;</span>).<span class="title function_">find</span>(<span class="string">&quot;input[name=&#x27;result-attempt&#x27;]&quot;</span>).<span class="title function_">val</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#attempt-form&quot;</span>).<span class="title function_">find</span>(<span class="string">&quot;input[name=&#x27;user-alias&#x27;]&quot;</span>).<span class="title function_">val</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">// 무작위 문제를 API로 가져와서 추가하기</span></span><br><span class="line">        $(<span class="string">&#x27;.multiplication-a&#x27;</span>).<span class="title function_">empty</span>().<span class="title function_">append</span>(data.<span class="property">factorA</span>);</span><br><span class="line">        $(<span class="string">&#x27;.multiplication-b&#x27;</span>).<span class="title function_">empty</span>().<span class="title function_">append</span>(data.<span class="property">factorB</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">updateMultiplication</span>();</span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#attempt-form&quot;</span>).<span class="title function_">submit</span>(<span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 폼 기본 제출 막기</span></span><br><span class="line">        event.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 페이지에서 값 가져오기</span></span><br><span class="line">        <span class="keyword">var</span> a = $(<span class="string">&#x27;.multiplication-a&#x27;</span>).<span class="title function_">text</span>();</span><br><span class="line">        <span class="keyword">var</span> b = $(<span class="string">&#x27;.multiplication-b&#x27;</span>).<span class="title function_">text</span>();</span><br><span class="line">        <span class="keyword">var</span> $form = $(<span class="variable language_">this</span>),</span><br><span class="line">            attempt = $form.<span class="title function_">find</span>(<span class="string">&quot;input[name=&#x27;result-attempt&#x27;]&quot;</span>).<span class="title function_">val</span>(),</span><br><span class="line">            userAlias = $form.<span class="title function_">find</span>(<span class="string">&quot;input[name=&#x27;user-alias&#x27;]&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// API 에 맞게 데이터를 조합하기</span></span><br><span class="line">        <span class="keyword">var</span> data = &#123;<span class="attr">user</span>: &#123;<span class="attr">alias</span>: userAlias&#125;, <span class="attr">multiplication</span>: &#123;<span class="attr">factorA</span>: a, <span class="attr">factorB</span>: b&#125;, <span class="attr">resultAttempt</span>: attempt&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// POST를 이용해서 데이터 보내기</span></span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: <span class="string">&#x27;/results&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data),</span><br><span class="line">            <span class="attr">contentType</span>: <span class="string">&quot;application/json; charset=utf-8&quot;</span>,</span><br><span class="line">            <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">result</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (result.<span class="property">correct</span>) &#123;</span><br><span class="line">                    $(<span class="string">&#x27;.result-message&#x27;</span>).<span class="title function_">empty</span>().<span class="title function_">append</span>(<span class="string">&quot;정답입니다! 축하드려요!&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    $(<span class="string">&#x27;.result-message&#x27;</span>).<span class="title function_">empty</span>().<span class="title function_">append</span>(<span class="string">&quot;오답입니다! 그래도 포기하지 마세요!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="title function_">updateMultiplication</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>화면작업 마무리 되었으면 어플리케이션을 실행해서 확인해보자.</p>
<h2 id="새로운-요구사항"><a href="#새로운-요구사항" class="headerlink" title="새로운 요구사항"></a>새로운 요구사항</h2><blockquote>
<p>최근에 제출한 답안을 보고 싶어요. 그러면 시간이 지나면서 내가 얼마나 잘하고 있는지 또는 못하고 있는지 알 수 있어요.</p>
</blockquote>
<hr/>

<ul>
<li><p>MultiplicationResultAttempt 클래스의 인스턴스를 모두 저장합니다. 그렇게 하면 나중에 추출해서 사용할 수 있습니다.</p>
</li>
<li><p>특정 사용자의 최근 답안을 가져오는 새로운 REST 엔드포인트를 만듭니다.</p>
</li>
<li><p>답안을 검색하는 새로운 서비스(비지니스 로직)을 만듭니다.</p>
</li>
<li><p>사용자가 답안을 제출하면 답안 내역을 보여주는 웹 페이지를 만듭니다.</p>
</li>
</ul>
<hr/>

<h2 id="애자일과-리팩토링"><a href="#애자일과-리팩토링" class="headerlink" title="애자일과 리팩토링"></a>애자일과 리팩토링</h2><p>애자일 방법론에 따라 일하려면 리팩토링을 일의 일부분으로 받아들여야 한다. 프로젝트 초기 단계에서 설계에 많은 시간을 투자하는 것은 잘못됐다는 것을 의미한다.</p>
<p>균형을 찾는 것이 핵심이다. 실제 비지니스는 사업이고 시간과의 싸움이기 때문에 기술적으로 완벽함을 찾는 것이나, 완벽한 설계도를 그리는 것에 시간을 쏟지 말아라는 의미 같다. 리팩토링은 필수적인 것이며, 요구사항이 바뀌어 가면서 소스도 바뀌어 가는 것. 그것이 애자일 방법론의 생각인 것 같다.</p>
<p>요구사항이 변경되어 소스에 점점 문제가 보이는 것을 방치한다면 그것은 기술부채가 되며 나중에 점점 큰 자원이 들어가게 되는 부분이 된다. 그렇기 때문에 이 애자일 방법론을 따를 때 중요한 것은 기술부채가 발생하지 않도록 문제가 발생했다면 바로바로 리팩토링하는 것이 중요하다.</p>
<p>불필요한 계산을 피하기 위해 코드를 수정합니다. 답안에 불린 값을 저장하고 데이터베이스에서 쿼리를 이용해 사용자가 맞춘 답안을 읽어올 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> User&#125;가 &#123;<span class="doctag">@link</span> Multiplication&#125;을 계산한 답안을 정의한 클래스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttempt</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(cascade = CascadeType.PERSIST)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;USER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(cascade = CascadeType.PERSIST)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;MULTIPLICATION_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Multiplication multiplication;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> resultAttempt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> correct;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON (역)직렬화를 위한 빈 생성자</span></span><br><span class="line">    MultiplicationResultAttempt() &#123;</span><br><span class="line">        user = <span class="literal">null</span>;</span><br><span class="line">        multiplication = <span class="literal">null</span>;</span><br><span class="line">        resultAttempt = -<span class="number">1</span>;</span><br><span class="line">        correct = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>생성자가 변경되었기 때문에 오류가 발생하는 MultiplicationServiceImplTest 객체를 수정하자. 생성자 보면 correct 필드를 위해 false 값을 넣었다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkCorrectAttemptTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3000</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">attemptResult</span> <span class="operator">=</span> multiplicationServiceImpl.checkAttempt(attempt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(attemptResult).isTrue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkWrongAttemptTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3010</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">attemptResult</span> <span class="operator">=</span> multiplicationServiceImpl.checkAttempt(attempt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(attemptResult).isFalse();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>실제 답안을 체크하는 비지니스 로직 <em>checkAttemp()</em> 함수를 수정하자<br>여기 조금 의아한 부분이 객체지향 설계가 안되어 있다. MultiplicationResultAttempt 도메인이 가져야할 로직들이 이 서비스 로직에 드러나 있다. 이 글의 요점이 아니라 그런건가.. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAttempt</span><span class="params">(MultiplicationResultAttempt attempt)</span> &#123;</span><br><span class="line">        <span class="comment">// 답안을 채점</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">correct</span> <span class="operator">=</span> attempt.getResultAttempt() ==</span><br><span class="line">                attempt.getMultiplication().getFactorA() *</span><br><span class="line">                        attempt.getMultiplication().getFactorB();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 조작된 답안을 방지</span></span><br><span class="line">        Assert.isTrue(!attempt.isCorrect(), <span class="string">&quot;채점한 상태로 보낼 수 없습니다!!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 복사본을 만들고 crrect 필드를 상황에 맞게 설정</span></span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">checkAttempt</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(attempt.getUser(), attempt.getMultiplication(), attempt.getResultAttempt(), correct);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 결과를 반환</span></span><br><span class="line">        <span class="keyword">return</span> correct;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>기존에는 ResultResponse 객체를 사용해서 응답을 내렸는데, 이번에는 DTO 아예 없애고 MultiplicationResultAttempt 도메인 객체로 내린다.<br>관련해서 컨트롤러 쪽도 수정하자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    ResponseEntity&lt;MultiplicationResultAttempt&gt; <span class="title function_">postResult</span><span class="params">(<span class="meta">@RequestBody</span> MultiplicationResultAttempt multiplicationResultAttempt)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isCorrect</span> <span class="operator">=</span> multiplicationService.checkAttempt(multiplicationResultAttempt);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attemptCopy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(</span><br><span class="line">                multiplicationResultAttempt.getUser(),</span><br><span class="line">                multiplicationResultAttempt.getMultiplication(),</span><br><span class="line">                multiplicationResultAttempt.getResultAttempt(),</span><br><span class="line">                isCorrect</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(attemptCopy);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MultiplicationResultAttemptController 컨트롤러 객체 응답이 변경되었으니 이에 맞추어 테스트 코드도 수정하자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptControllerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">genericParameterizedTest</span><span class="params">(<span class="keyword">final</span> <span class="type">boolean</span> correct)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// given (지금 서비스를 테스트하는 것이 아님)</span></span><br><span class="line">        given(multiplicationService</span><br><span class="line">                .checkAttempt(any(MultiplicationResultAttempt.class)))</span><br><span class="line">                .willReturn(correct);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john&quot;</span>);</span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">70</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3500</span>, correct);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">MockHttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> mvc.perform(</span><br><span class="line">                post(<span class="string">&quot;/results&quot;</span>).contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">                        .content(jsonResult.write(attempt).getJson()))</span><br><span class="line">                .andReturn().getResponse();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(response.getStatus()).isEqualTo(HttpStatus.OK.value());</span><br><span class="line">        assertThat(response.getContentAsString()).isEqualTo(</span><br><span class="line">                jsonResult.write(</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(</span><br><span class="line">                                attempt.getUser(),</span><br><span class="line">                                attempt.getMultiplication(),</span><br><span class="line">                                attempt.getResultAttempt(), correct)</span><br><span class="line">                ).getJson());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="데이터-레이어"><a href="#데이터-레이어" class="headerlink" title="데이터 레이어"></a>데이터 레이어</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ... --&gt;</span>        </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># H2 데이터베이스 웹 콘솔에 접속</span><br><span class="line">spring.h2.console.enabled=true</span><br><span class="line"># 데이터베이스가 &#x27;없는 경우에만&#x27; 데이터베이스를 생성</span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line"># 파일로 데이터베이스를 생성</span><br><span class="line">spring.datasource.url=jdbc:h2:file:~/social-multiplication;DB_CLOSE_ON_EXIT=FALSE;</span><br><span class="line"># 학습 목적으로 콘솔에 SQL을 출력</span><br><span class="line">spring.jpa.properties.hibernate.show_sql=true</span><br></pre></td></tr></table></figure>
<p>Multiplication 도메인도 JPA 를 활용해 데이터 모델로 변경해보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 애플리케이션에서 곱셈을 나타내는 클래스 (a * b)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Multiplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;MULTIPLICATION_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 두 인수</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> factorA;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> factorB;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON (역)직렬화를 위한 빈 생성자</span></span><br><span class="line">    Multiplication() &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr/>

<ul>
<li><p>@Entity 애너테이션으로 JPA 저장소에 저장할 수 있는 JPA의 개체임을 명시합니다. JPA에서 리플렉션을 통해 객체를 인스턴스화할 때 필요한 빈 생성자도 있습니다.</p>
</li>
<li><p>기본키로 유일한 식별자를 사용하기 위해 자바 Long 클래스를 활용합니다. @Id 애너테이션은 기본키를 의미하고 @GeneratedValue는 따로 값을 지정하지 않아도 자동으로 생성되는 값입니다.</p>
</li>
<li><p>컬럼명을 JPA가 지정해주는 대신 명시적으로 설정해야 할 경우가 있습니다. 이런 경우에는 @Column 애너테이션으로 컬럼명을 지정합니다. </p>
</li>
</ul>
<hr/>

<p>User 클래스도 수정하자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 사용자 정보를 저장하는 클래스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;USER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String alias;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JSON (역)직렬화를 위한 빈 생성자</span></span><br><span class="line">    <span class="keyword">protected</span>  <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">        alias = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Repository 쪽을 만들어보자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 답안을 저장하고 조회하기 위한 인터페이스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MultiplicationResultAttemptRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;MultiplicationResultAttempt, Long&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 닉네임에 해당하는 사용자의 최근 답안 5개</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;MultiplicationResultAttempt&gt; <span class="title function_">findTop5ByUserAliasOrderByIdDesc</span><span class="params">(String userAlias)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> microservices.book.multiplication.multiplication.domain.Multiplication&#125; 을 저장하고 조회하기 위한 인터페이스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MultiplicationRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;Multiplication, Long&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> microservices.book.multiplication.multiplication.domain.User&#125; 를 저장하고 조회하기 위한 인터페이스</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByAlias</span><span class="params">(<span class="keyword">final</span> String alias)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>리포지토리를 만들때에는 왜 TDD를 사용하지 않는가? 간단합니다. 이건 새로운 코드가 아니라 스프링에서 제공하는 코드이기 때문에 믿을 수 있고 따로 단위 테스트를 작성할 필요가 없습니다</p>
<p>TDD로 돌아가서 위 Repository를 사용하는 Service 코드를 검증하는 단위 테스트 코드를 추가하자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> MultiplicationResultAttemptRepository attemptRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// initMocks 를 호출해 Mockito 가 어노테이션을 처리하도록 지시</span></span><br><span class="line">        MockitoAnnotations.initMocks(<span class="built_in">this</span>);</span><br><span class="line">        multiplicationServiceImpl = <span class="keyword">new</span> <span class="title class_">MultiplicationServiceImpl</span>(randomGeneratorService, attemptRepository, userRepository);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createRandomMultiplicationTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given (목 객체가 처음에 50, 나중에 30 을 반환하도록 설정)</span></span><br><span class="line">        given(randomGeneratorService.generateRandomFactor()).willReturn(<span class="number">50</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> multiplicationServiceImpl.createRandomMultiplication();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// assert</span></span><br><span class="line">        assertThat(multiplication.getFactorA()).isEqualTo(<span class="number">50</span>);</span><br><span class="line">        assertThat(multiplication.getFactorB()).isEqualTo(<span class="number">30</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkCorrectAttemptTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3000</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">verifiedAttempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3000</span>, <span class="literal">true</span>);</span><br><span class="line">        given(userRepository.findByAlias(<span class="string">&quot;john_doe&quot;</span>)).willReturn(Optional.empty());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">attemptResult</span> <span class="operator">=</span> multiplicationServiceImpl.checkAttempt(attempt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(attemptResult).isTrue();</span><br><span class="line">        verify(attemptRepository).save(verifiedAttempt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkWrongAttemptTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(user, multiplication, <span class="number">3010</span>, <span class="literal">false</span>);</span><br><span class="line">        given(userRepository.findByAlias(<span class="string">&quot;john_doe&quot;</span>)).willReturn(Optional.empty());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">attemptResult</span> <span class="operator">=</span> multiplicationServiceImpl.checkAttempt(attempt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(attemptResult).isFalse();</span><br><span class="line">        verify(attemptRepository).save(attempt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr/>

<ul>
<li><p>서비스 계층의 단위 테스트에 집중하기 위해 MultiplicationResultAttemptRepository 와 UserRepository 의 목 객체가 필요합니다. MultiplicationServiceImpl 생성자에 인자로 넘겨주고 있는데, 나중에 해당 클래스를 수정할 때 수정하거나 아니면 지금 새로운 생성자를 만들 수도 있습니다.</p>
</li>
<li><p>checkCorrectAttemptTest() 메서드는 실제처럼 하기 위해 attempt 의 복사본(verifiedAttempt)을 만듭니다. 사용자가 보낸 답안은 correct 필드가 false 여야만 합니다. 그리고 마지막 줄에서 Mockito 로 correct 가 true 인 답안을 저장하는 경우를 verify 합니다.</p>
</li>
<li><p>checkWrongAttemptTest() 메서드는 틀린 답을 검증합니다. 호출이 실제로 실행되는 것은 아닙니다. 목 객체가 해당 인자를 가지고 동작하는지 테스트하는 것뿐입니다.</p>
</li>
</ul>
<hr/>

<h2 id="Layer-Connection"><a href="#Layer-Connection" class="headerlink" title="Layer Connection"></a>Layer Connection</h2><p>To show the list registed recently, let’s create new API and service unit.</p>
<p>We should create the message at <em>‘MultiplicationService’</em> interface for getting the list graded recently.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    List&lt;MultiplicationResultAttempt&gt; <span class="title function_">getStatsForUser</span><span class="params">(<span class="keyword">final</span> String userAlias)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>and let’s it implements.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;MultiplicationResultAttempt&gt; <span class="title function_">getStatsForUser</span><span class="params">(String userAlias)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> attemptRepository.findTop5ByUserAliasOrderByIdDesc(userAlias);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>let’s make the test code for <em>getStatsForUser()</em>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">retrieveStatsTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">60</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(</span><br><span class="line">                user, multiplication, <span class="number">3010</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(</span><br><span class="line">                user, multiplication, <span class="number">3051</span>, <span class="literal">false</span>);</span><br><span class="line">        List&lt;MultiplicationResultAttempt&gt; latestAttempts = Lists.newArrayList(attempt1, attempt2);</span><br><span class="line">        given(userRepository.findByAlias(<span class="string">&quot;john_doe&quot;</span>)).willReturn(Optional.empty());</span><br><span class="line">        given(attemptRepository.findTop5ByUserAliasOrderByIdDesc(<span class="string">&quot;john_doe&quot;</span>))</span><br><span class="line">                .willReturn(latestAttempts);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        List&lt;MultiplicationResultAttempt&gt; latestAttemptsResult =</span><br><span class="line">                multiplicationServiceImpl.getStatsForUser(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(latestAttemptsResult).isEqualTo(latestAttempts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>and after that, We should add the function for rest api at <em>MultiplicationResultAttemptController</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    ResponseEntity&lt;List&lt;MultiplicationResultAttempt&gt;&gt; <span class="title function_">getStatistics</span><span class="params">(<span class="meta">@RequestParam(&quot;alias&quot;)</span> String alias)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(multiplicationService.getStatsForUser(alias));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptControllerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUserStats</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// given</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;john_doe&quot;</span>);</span><br><span class="line">        <span class="type">Multiplication</span> <span class="variable">multiplication</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Multiplication</span>(<span class="number">50</span>, <span class="number">70</span>);</span><br><span class="line">        <span class="type">MultiplicationResultAttempt</span> <span class="variable">attempt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(</span><br><span class="line">                user, multiplication, <span class="number">3500</span>, <span class="literal">true</span>);</span><br><span class="line">        List&lt;MultiplicationResultAttempt&gt; recentAttempts = Lists.newArrayList(attempt, attempt);</span><br><span class="line">        given(multiplicationService</span><br><span class="line">                .getStatsForUser(<span class="string">&quot;john_doe&quot;</span>))</span><br><span class="line">                .willReturn(recentAttempts);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// when</span></span><br><span class="line">        <span class="type">MockHttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> mvc.perform(</span><br><span class="line">                get(<span class="string">&quot;/results&quot;</span>).param(<span class="string">&quot;alias&quot;</span>, <span class="string">&quot;john_doe&quot;</span>))</span><br><span class="line">                .andReturn().getResponse();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// then</span></span><br><span class="line">        assertThat(response.getStatus()).isEqualTo(HttpStatus.OK.value());</span><br><span class="line">        assertThat(response.getContentAsString()).isEqualTo(</span><br><span class="line">                jsonResultAttemptList.write(recentAttempts).getJson());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">updateStats</span>(<span class="params">alias</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;http://localhost:8080/results?alias=&quot;</span> + alias,</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;#stats-body&#x27;</span>).<span class="title function_">empty</span>();</span><br><span class="line">        data.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">row</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#stats-body&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;tr&gt;&lt;td&gt;&#x27;</span> + row.<span class="property">id</span> + <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&lt;td&gt;&#x27;</span> + row.<span class="property">multiplication</span>.<span class="property">factorA</span> + <span class="string">&#x27; x &#x27;</span> + row.<span class="property">multiplication</span>.<span class="property">factorB</span> + <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&lt;td&gt;&#x27;</span> + row.<span class="property">resultAttempt</span> + <span class="string">&#x27;&lt;/td&gt;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&lt;td&gt;&#x27;</span> + (row.<span class="property">correct</span> === <span class="literal">true</span> ? <span class="string">&#x27;YES&#x27;</span> : <span class="string">&#x27;NO&#x27;</span>) + <span class="string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Multiplication v1<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;multiplication-client.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>안녕하세요, 소셜 곱셈입니다!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>오늘의 문제:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;multiplication-a&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> x <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;multiplication-b&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> =</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;attempt-form&quot;</span>&gt;</span></span><br><span class="line">        답은? <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;result-attempt&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        닉네임: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user-alias&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;확인&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;result-message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>통계<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;stats&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:100%&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>답안 ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>곱셈<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>입력한 값<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>정답?<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span> <span class="attr">id</span>=<span class="string">&quot;stats-body&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Let’s-start-to-do-microservice"><a href="#Let’s-start-to-do-microservice" class="headerlink" title="Let’s start to do microservice"></a>Let’s start to do microservice</h2><p>microservice isn’t fit with creating the prototype. because the prototype usually should be created as soon as possible. but building the microservice isn’t easier than the monolithic one.</p>
<p>so when you launch the new service, I recommend you to build it as monolithic system.</p>
<p>Refactoring is always needed in the agile progamming paradigm so Don’t be avoid it.</p>
<h2 id="Scalability"><a href="#Scalability" class="headerlink" title="Scalability"></a>Scalability</h2><p>let’s suppose that the one of the microservices takes traffics a lot, then we gotta expand the microservice without anothers.</p>
<p>but it’s impossible to control each service at monolithic system.</p>
<p>Server and Infra are always the cost so Software enginner should consider it.</p>
<h2 id="Connecting-each-microservices"><a href="#Connecting-each-microservices" class="headerlink" title="Connecting each microservices"></a>Connecting each microservices</h2><p>How can do we connect between each microservices?</p>
<ul>
<li><p>Sharing the same database. This solution is not proper with microservice essentially. because the one of purpose of microservice is separating the business context, but this solution is not keep this rule.</p>
</li>
<li><p>Building the batch service pushing the updated list between each one. but this way couldn’t offer the real time service.</p>
</li>
</ul>
<p>…</p>
<h2 id="Event-Driven-Architecture"><a href="#Event-Driven-Architecture" class="headerlink" title="Event Driven Architecture"></a>Event Driven Architecture</h2><p>Most of companies with microservice structure use Event to notify any actions, changes for each microservices.</p>
<p>Each microservices take the published event through Event Bus and they can publish the event when they want.</p>
<h2 id="The-benfit-and-disadvantage-of-Event-Driven-Architecture"><a href="#The-benfit-and-disadvantage-of-Event-Driven-Architecture" class="headerlink" title="The benfit and disadvantage of Event Driven Architecture"></a>The benfit and disadvantage of Event Driven Architecture</h2><ul>
<li>Loose coupling</li>
</ul>
<p>Each microservices can have own context area. It should be independent, then the changes of their process are not affect to other one.</p>
<ul>
<li>Transaction</li>
</ul>
<p>Event Driven Architecture can’t keep ACID Transaction principle. if one transaction needs multiple services, we have to do lots of things to keep the ACID principle like Rollback processing.</p>
<ul>
<li>Fault Tolerance</li>
</ul>
<p>When the one of microservices is shuted down, another microservices depended it should have the policy how can handle this problem.</p>
<ul>
<li>Difficulty to trace log.</li>
</ul>
<p>Event Driven Architecture is really hard to trace the log because it is built separately. so We should have the occastration layer to check it like a gateway.</p>
<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><p>let’s inject dependency of amqp.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>setting exchange key at application.properties</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">## RabbitMQ 설정</span><br><span class="line">multiplication.exchange=multiplication_exchange</span><br><span class="line">multiplication.solved.key=multiplication.solved</span><br></pre></td></tr></table></figure>
<ul>
<li>Configuration RabbitTemplate, TopicExchange</li>
</ul>
<p>RabbitMQ is configured enable to communicate as Json type as you can see.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">multiplicationExchange</span><span class="params">(<span class="meta">@Value(&quot;$&#123;multiplication.exchange&#125;&quot;)</span> <span class="keyword">final</span> String exchangeName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(exchangeName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RabbitTemplate <span class="title function_">rabbitTemplate</span><span class="params">(<span class="keyword">final</span> ConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">RabbitTemplate</span> <span class="variable">rabbitTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RabbitTemplate</span>(connectionFactory);</span><br><span class="line">        rabbitTemplate.setMessageConverter(producerJackson2MessageConverter());</span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Jackson2JsonMessageConverter <span class="title function_">producerJackson2MessageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Modeling Event object.</li>
</ul>
<p>It’s dangerous to use the changeable data as the event field. these data will make any confuse to each microservices.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationSolvedEvent</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long multiplicationResultAttemptId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">boolean</span> correct;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventDispatcher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Multiplication 관련 정보를 전달하기 위한 익스체인지</span></span><br><span class="line">    <span class="keyword">private</span> String multiplicationExchange;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 특정 이벤트를 전송하기 위한 라우팅 키</span></span><br><span class="line">    <span class="keyword">private</span> String multiplicationSolvedRoutingKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    EventDispatcher(<span class="keyword">final</span> RabbitTemplate rabbitTemplate,</span><br><span class="line">                    <span class="meta">@Value(&quot;$&#123;multiplication.exchange&#125;&quot;)</span> <span class="keyword">final</span> String multiplicationExchange,</span><br><span class="line">                    <span class="meta">@Value(&quot;$&#123;multiplication.solved.key&#125;&quot;)</span> <span class="keyword">final</span> String multiplicationSolvedRoutingKey) &#123;</span><br><span class="line">        <span class="built_in">this</span>.rabbitTemplate = rabbitTemplate;</span><br><span class="line">        <span class="built_in">this</span>.multiplicationExchange = multiplicationExchange;</span><br><span class="line">        <span class="built_in">this</span>.multiplicationSolvedRoutingKey = multiplicationSolvedRoutingKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(<span class="keyword">final</span> MultiplicationSolvedEvent multiplicationSolvedEvent)</span> &#123;</span><br><span class="line">        rabbitTemplate.convertAndSend(</span><br><span class="line">                multiplicationExchange,</span><br><span class="line">                multiplicationSolvedRoutingKey,</span><br><span class="line">                multiplicationSolvedEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AMQP supports Transaction. so It will not send the event when the method occurs the exception with <em>@Transaction</em> annotation.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MultiplicationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkAttempt</span><span class="params">(MultiplicationResultAttempt attempt)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 이벤트로 결과를 전송</span></span><br><span class="line">        eventDispatcher.send(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">MultiplicationSolvedEvent</span>(checkAttempt.getId(),</span><br><span class="line">                        checkAttempt.getUser().getId(),</span><br><span class="line">                        checkAttempt.isCorrect())</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> isCorrect;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>after this code, you should fix <em>MultiplicationServiceImplTest</em> class. because the existing one doesn’t have the code to check whether event message is sent well or not.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Badge</span> &#123;</span><br><span class="line">    <span class="comment">// 점수로 획득하는 배지</span></span><br><span class="line">    BRONZE_MULTIPLICATOR,</span><br><span class="line">    SILVER_MULTIPLICATOR,</span><br><span class="line">    GOLD_MULTIPLICATOR,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 특정 조건으로 획득하는 배지</span></span><br><span class="line">    FIRST_ATTEMPT,</span><br><span class="line">    FIRST_WON,</span><br><span class="line">    LUCKY_NUMBER</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">BadgeCard</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;BADGE_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long badgeID;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> badgeTimestamp;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Badge badge;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BadgeCard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BadgeCard</span><span class="params">(<span class="keyword">final</span> Long userId, <span class="keyword">final</span> Badge badge)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="literal">null</span>, userId, System.currentTimeMillis(), badge);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">GameStats</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Badge&gt; badges;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GameStats</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userId = <span class="number">0L</span>;</span><br><span class="line">        <span class="built_in">this</span>.score = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.badges = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> GameStats <span class="title function_">emptyStats</span><span class="params">(<span class="keyword">final</span> Long userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GameStats</span>(userId, <span class="number">0</span>, Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Badge&gt; <span class="title function_">getBadges</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableList(badges);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">LeaderBoardRow</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long userId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long totalScore;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LeaderBoardRow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="number">0L</span>, <span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 점수와 답안을 연결하는 클래스</span></span><br><span class="line"><span class="comment"> * 사용자와 점수가 등록된 시간의 타임스탬프를 포함</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">ScoreCard</span> &#123;</span><br><span class="line">    <span class="comment">// 명시되지 않은 경우 이 카드에 할당되는 기본 점수</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_SCORE</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;CARD_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long cardId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;USER_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;ATTEMPT_ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long attemptId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;SCORE_TS&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> scoreTimestamp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;SCORE&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> score;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScoreCard</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ScoreCard</span><span class="params">(<span class="keyword">final</span> Long userId, <span class="keyword">final</span> Long attemptId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>(<span class="literal">null</span>, userId, attemptId, System.currentTimeMillis(), DEFAULT_SCORE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Only <em>ScoreCard</em> and <em>BadgeCard</em> are the domain what you should save in database through repository among those five domain classes.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BadgeCardRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;BadgeCard, Long&gt; &#123;</span><br><span class="line">    List&lt;BadgeCard&gt; <span class="title function_">findByUserIdOrderByBadgeTimestampDesc</span><span class="params">(<span class="keyword">final</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ScoreCardRepository</span> <span class="keyword">extends</span> <span class="title class_">CrudRepository</span>&lt;ScoreCard, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT SUM(s.score) FROM microservices.book.gamification.domain.ScoreCard s WHERE s.userId = :userId GROUP BY s.userId&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getTotalScoreForUser</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> <span class="keyword">final</span> Long userId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(&quot;SELECT NEW microservices.book.gamification.domain.LeaderBoardRow(s.userId, SUM(s.score)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;FROM microservices.book.gamification.domain.ScoreCard s &quot; +</span></span><br><span class="line"><span class="meta">            &quot;GROUP BY s.userId ORDER BY SUM(s.score) DESC&quot;)</span></span><br><span class="line">    List&lt;LeaderBoardRow&gt; <span class="title function_">findFirst10</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    List&lt;ScoreCard&gt; <span class="title function_">findByUserIdOrderByScoreTimestampDesc</span><span class="params">(<span class="keyword">final</span> Long userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>ScoreCardRepository</em> is built by JPQL(Java Persistence Query Language). and JPQL keeps the abstraction rules to use itself for any database not for specific database.</p>
<h2 id="Business-Logics"><a href="#Business-Logics" class="headerlink" title="Business Logics"></a>Business Logics</h2><p>This system is required two business logics. the one is <em>GameService</em> and the other is <em>LeaderBoardService</em>.</p>
<ul>
<li><p>GameService : It’s for calculating the scores and the badges based on grading what is taken.</p>
</li>
<li><p>LeaderBoardService : It’s for Looking up the 10 users who takes highest the scores.</p>
</li>
</ul>
<h2 id="Initialization-RabbitMQ"><a href="#Initialization-RabbitMQ" class="headerlink" title="Initialization RabbitMQ"></a>Initialization RabbitMQ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitMQConfiguration</span> <span class="keyword">implements</span> <span class="title class_">RabbitListenerConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TopicExchange <span class="title function_">multiplicationExchange</span><span class="params">(<span class="meta">@Value(&quot;$&#123;multiplication.exchange&#125;&quot;)</span> <span class="keyword">final</span> String exchangeName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicExchange</span>(exchangeName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">gamificationMultiplicationQueue</span><span class="params">(<span class="meta">@Value(&quot;$&#123;multiplication.queue&#125;&quot;)</span> <span class="keyword">final</span> String queueName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(queueName, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Binding <span class="title function_">binding</span><span class="params">(<span class="keyword">final</span> Queue queue, <span class="keyword">final</span> TopicExchange exchange, <span class="meta">@Value(&quot;$&#123;multiplication.anything.routing-key&#125;&quot;)</span> <span class="keyword">final</span> String routingKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(routingKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MappingJackson2MessageConverter <span class="title function_">consumerJackson2MessageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2MessageConverter</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultMessageHandlerMethodFactory <span class="title function_">messageHandlerMethodFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultMessageHandlerMethodFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMessageHandlerMethodFactory</span>();</span><br><span class="line">        factory.setMessageConverter(consumerJackson2MessageConverter());</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureRabbitListeners</span><span class="params">(<span class="keyword">final</span> RabbitListenerEndpointRegistrar registrar)</span> &#123;</span><br><span class="line">        registrar.setMessageHandlerMethodFactory(messageHandlerMethodFactory());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>this RabbitMQ configuration bind with Exchange and Routing Key to Queue. and <em>consumerJackson2MessageConverter()</em>, <em>messageHandlerMethodFactory()</em>, <em>configureRabbitListeners()</em> methods are for setting Json Deserialization.</p>
<h2 id="Data-Communication-between-each-microservices"><a href="#Data-Communication-between-each-microservices" class="headerlink" title="Data Communication between each microservices."></a>Data Communication between each microservices.</h2><p>Reactive pattern means communication based on Event and unlike that pattern, Request/Response pattern means communication based on REST API.</p>
<p>Event only should have immutable data. and the reason was already refer the above.</p>
<h2 id="Keeping-the-domain-as-isolaed-status"><a href="#Keeping-the-domain-as-isolaed-status" class="headerlink" title="Keeping the domain as isolaed status."></a>Keeping the domain as isolaed status.</h2><p>if the specific domain can be accessed all of microservices, then Each microservices have dependency between themselves because of this domain. It means that all of microservices using the domain have to be considered whenever the domain is changed.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonDeserialize(using = MultiplicationResultAttemptDeserializer.class)</span></span><br></pre></td></tr></table></figure>
<p>@JsonDeserialize annotation can offer the customization of Json type deserialization when RestTemplate is used. and that is MultiplicationResutAttemptDeserializer object</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiplicationResultAttemptDeserializer</span> <span class="keyword">extends</span> <span class="title class_">JsonDeserializer</span>&lt;MultiplicationResultAttempt&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MultiplicationResultAttempt <span class="title function_">deserialize</span><span class="params">(JsonParser jsonParser, DeserializationContext deserializationContext)</span> <span class="keyword">throws</span> IOException, JsonProcessingException &#123;</span><br><span class="line">        <span class="type">ObjectCodec</span> <span class="variable">oc</span> <span class="operator">=</span> jsonParser.getCodec();</span><br><span class="line">        <span class="type">JsonNode</span> <span class="variable">node</span> <span class="operator">=</span> oc.readTree(jsonParser);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MultiplicationResultAttempt</span>(node.get(<span class="string">&quot;user&quot;</span>).get(<span class="string">&quot;alias&quot;</span>).asText(),</span><br><span class="line">                node.get(<span class="string">&quot;multiplication&quot;</span>).get(<span class="string">&quot;factorA&quot;</span>).asInt(),</span><br><span class="line">                node.get(<span class="string">&quot;multiplication&quot;</span>).get(<span class="string">&quot;factorB&quot;</span>).asInt(),</span><br><span class="line">                node.get(<span class="string">&quot;resultAttempt&quot;</span>).asInt(),</span><br><span class="line">                node.get(<span class="string">&quot;correct&quot;</span>).asBoolean());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Installing-RabbitMQ-server-based-on-Docker"><a href="#Installing-RabbitMQ-server-based-on-Docker" class="headerlink" title="Installing RabbitMQ server based on Docker"></a>Installing RabbitMQ server based on Docker</h2><p>Firstly, we should pull the rabbitmq image from dockerhurbs.</p>
<p>and let’s launch this rabbitmq image.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker pull rabbitmq:management</span><br><span class="line"></span><br><span class="line">&gt; docker run -d --name rabbitmq -p 5672:5672 -p 15672:15672 -p 25672:25672 -p 35197:35197 --restart=unless-stopped -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest rabbitmq:management</span><br></pre></td></tr></table></figure>
<h2 id="How-can-solve-the-problem-what-docker-is-not-operated-will-with-showing-the-error-message-‘Cannot-connect-to-the-Docker-daemon-at-unix-var-run-docker-sock-Is-the-docker-daemon-running-’"><a href="#How-can-solve-the-problem-what-docker-is-not-operated-will-with-showing-the-error-message-‘Cannot-connect-to-the-Docker-daemon-at-unix-var-run-docker-sock-Is-the-docker-daemon-running-’" class="headerlink" title="How can solve the problem what docker is not operated will with showing the error message ‘Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?’"></a>How can solve the problem what docker is not operated will with showing the error message ‘Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?’</h2><p>this situation is occured when your docker daemon process is stopped. in my case, i just solved this problem as re-installing docker program. </p>
<h2 id="Solving-the-error-‘homebrew-core-is-a-shallow-clone’-when-you-use-brew-command"><a href="#Solving-the-error-‘homebrew-core-is-a-shallow-clone’-when-you-use-brew-command" class="headerlink" title="Solving the error ‘homebrew-core is a shallow clone’ when you use brew command."></a>Solving the error ‘homebrew-core is a shallow clone’ when you use <em>brew</em> command.</h2><p>the solution in already in the message what you taken in terminal with <em>brew</em> command. you just fetch the code from the below two repositories related with <em>brew</em>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git -C /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core fetch --unshallow</span><br><span class="line">git -C /usr/local/Homebrew/Library/Taps/homebrew/homebrew-cask fetch --unshallow</span><br></pre></td></tr></table></figure>
<h2 id="Installing-rabbitmq-in-local-with-brew-command"><a href="#Installing-rabbitmq-in-local-with-brew-command" class="headerlink" title="Installing rabbitmq in local with brew command"></a>Installing <em>rabbitmq</em> in local with <em>brew</em> command</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; brew update</span><br><span class="line"></span><br><span class="line">&gt; brew install rabbitmq</span><br><span class="line"></span><br><span class="line">// set environment variable for rabbitmq</span><br><span class="line">&gt; export PATH=$PATH:/user/local/sbin</span><br><span class="line"></span><br><span class="line">&gt; rabbitmq-server</span><br><span class="line"></span><br><span class="line">// It&#x27;s the launching command without setting envrionment variables</span><br><span class="line">&gt; /usr/local/sbin/rabbitmq-server</span><br></pre></td></tr></table></figure>
<h2 id="Creating-new-user-with-rabbitmqctl-command"><a href="#Creating-new-user-with-rabbitmqctl-command" class="headerlink" title="Creating new user with rabbitmqctl command"></a>Creating new user with <em>rabbitmqctl</em> command</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; rabbitmqctl add_user test test</span><br><span class="line"></span><br><span class="line">&gt; rabbitmqctl set_user_tags test administrator</span><br><span class="line"></span><br><span class="line">&gt; rabbitmqctl set_permissions -p / test &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Creating-new-user-with-rabbitmqctl-in-Docker"><a href="#Creating-new-user-with-rabbitmqctl-in-Docker" class="headerlink" title="Creating new user with rabbitmqctl in Docker"></a>Creating new user with <em>rabbitmqctl</em> in Docker</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker exec rabbitmq rabbitmqctl add_user test test</span><br><span class="line"></span><br><span class="line">&gt; docker exec rabbitmq rabbitmqctl set_user_tags test administrator</span><br><span class="line"></span><br><span class="line">&gt; docker exec rabbitmq rabbitmqctl set_permissions -p / test &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br></pre></td></tr></table></figure>
<h2 id="Turning-on-rabbitmq-management-option"><a href="#Turning-on-rabbitmq-management-option" class="headerlink" title="Turning on rabbitmq management option"></a>Turning on rabbitmq management option</h2><p>Rabbitmq Web management service is basically not turned on. so You should change the rabbitmq-plugins option to use it. </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker exec rabbitmq rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>
<h2 id="Migrating-static-contents-from-multiplication-to-new-server"><a href="#Migrating-static-contents-from-multiplication-to-new-server" class="headerlink" title="Migrating static contents from multiplication to new server"></a>Migrating static contents from multiplication to new server</h2><p>The book use <em>Jetty</em> web server to service the UI contents </p>
<p>First of all, We will install Jetty with <em>Homebrew</em>.  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; brew install jetty</span><br></pre></td></tr></table></figure>
<h2 id="Installing-Jetty-with-Docker"><a href="#Installing-Jetty-with-Docker" class="headerlink" title="Installing Jetty with Docker"></a>Installing Jetty with Docker</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; docker pull jetty</span><br><span class="line"></span><br><span class="line">&gt; docker run -d --name jetty -p 9090:8080 -p 9443:8443 jetty</span><br><span class="line"></span><br><span class="line">&gt; docker exec -it jetty /bin/bash</span><br></pre></td></tr></table></figure>
<h2 id="The-path-of-webapps-directory-in-jetty-docker-container"><a href="#The-path-of-webapps-directory-in-jetty-docker-container" class="headerlink" title="The path of webapps directory in jetty docker container"></a>The path of webapps directory in jetty docker container</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; /var/lib/jetty/webapps</span><br></pre></td></tr></table></figure>
<h2 id="Copying-file-betweeen-host-system-and-docker-container"><a href="#Copying-file-betweeen-host-system-and-docker-container" class="headerlink" title="Copying file betweeen host system and docker container"></a>Copying file betweeen host system and docker container</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// host -&gt; container</span><br><span class="line">&gt; docker cp [host file] [container name]:[container path]</span><br><span class="line"></span><br><span class="line">// container -&gt; host</span><br><span class="line">&gt; docker cp [container name]:[container path] [host file]</span><br></pre></td></tr></table></figure>
<h2 id="AopInvocationException-Null-return-value-from-advice-does-not-match-primitive-return-type-for"><a href="#AopInvocationException-Null-return-value-from-advice-does-not-match-primitive-return-type-for" class="headerlink" title="AopInvocationException: Null return value from advice does not match primitive return type for"></a>AopInvocationException: Null return value from advice does not match primitive return type for</h2><p>This exception is occured when your entities has a primitive type data. These data should be changed to boxed type like Interger, Float..</p>
<h2 id="access-h2-console-as-file-db"><a href="#access-h2-console-as-file-db" class="headerlink" title="access h2-console as file db."></a>access h2-console as file db.</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:h2:file:~/gamification;DB_CLOSE_ON_EXIT=FALSE;USER=myuser;PASSWORD=mypass</span><br></pre></td></tr></table></figure>
<p>if the above properties is configured in your h2 db, then you can access h2-console with the below information.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8081/h2-console</span><br><span class="line"></span><br><span class="line">jdbc:h2:file:~/gamification</span><br><span class="line"></span><br><span class="line">user : myuser</span><br><span class="line"></span><br><span class="line">password : mypass</span><br></pre></td></tr></table></figure>
<p>furthermore, you have to know one thing that you gotta delete the h2 file db when you want to change the user or password</p>
<p>the location is almostly C:/User/USER/</p>
<h2 id="The-components-of-Service-Discovery"><a href="#The-components-of-Service-Discovery" class="headerlink" title="The components of Service Discovery"></a>The components of Service Discovery</h2><ul>
<li>Service Registry</li>
<li>Register Agent</li>
<li>Service Discovery Client</li>
</ul>
<h2 id="The-version-Error-between-Spring-boot-and-Spring-Cloud"><a href="#The-version-Error-between-Spring-boot-and-Spring-Cloud" class="headerlink" title="The version Error between Spring boot and Spring Cloud"></a>The version Error between Spring boot and Spring Cloud</h2><p>The latest version of Spring boot is 2.6.1 but i don’t know the way add the spring cloud dependencies with this spring boot version. someday, I should solve this problems.. actually i learned one thing about this.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://spring.io/projects/spring-cloud</span><br></pre></td></tr></table></figure>
<p>You can get the version information of spring cloud.</p>
<h2 id="Zuul-routing-setting"><a href="#Zuul-routing-setting" class="headerlink" title="Zuul routing setting"></a>Zuul routing setting</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zuul:</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">/api</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="attr">multiplications:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/multiplications/**</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://localhost:8080/multiplications</span></span><br><span class="line">    <span class="attr">results:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/results/**</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://localhost:8080/results</span></span><br><span class="line">    <span class="attr">leaders:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/leaders/**</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://localhost:8081/leaders</span></span><br><span class="line">    <span class="attr">stats:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/stats/**</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">http://localhost:8081/stats</span></span><br></pre></td></tr></table></figure>
<p>prefix is deleted when Api Gateway call the each microservices.<br>ex) <a target="_blank" rel="noopener" href="http://localhost:8000/api/multiplications">http://localhost:8000/api/multiplications</a> -&gt; <a target="_blank" rel="noopener" href="http://localhost:8080/multiplications">http://localhost:8080/multiplications</a></p>
<p>after applying Api gateway, the clients don’t need to remember each endpoints of microservices. it just only should keep the endpoint of api gateway.</p>
<h2 id="Spring-Cloud-Version-Issue"><a href="#Spring-Cloud-Version-Issue" class="headerlink" title="Spring Cloud Version Issue"></a>Spring Cloud Version Issue</h2><p>When you want to use Spring Cloud in your spring boot project. You must consider the version.</p>
<p>the version is dependented deeply between spring boot and spring cloud.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></li>
</ul>
<p><img src="/res/2021-11-13-spring-msa/1.png" alt=""></p>
<p>in Spring boot 2.6.0 version case, you can check how we add the proper dependency of Spring Cloud at the below site.</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud">https://spring.io/projects/spring-cloud</a></li>
</ul>
<p>The below code is the sample adding dependency of Spring Cloud in Maven and Gradle.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>spring-milestones<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Spring Milestones<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2021.0.0-M1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">dependencies &#123;</span><br><span class="line">classpath <span class="string">&quot;io.spring.gradle:dependency-management-plugin:1.0.2.RELEASE&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">maven &#123;</span><br><span class="line">url <span class="string">&#x27;https://repo.spring.io/milestone&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&quot;io.spring.dependency-management&quot;</span></span><br><span class="line"></span><br><span class="line">dependencyManagement &#123;</span><br><span class="line">imports &#123;</span><br><span class="line">mavenBom <span class="string">&#x27;org.springframework.cloud:spring-cloud-dependencies:2021.0.0-M1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">compile <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-config&#x27;</span></span><br><span class="line">compile <span class="string">&#x27;org.springframework.cloud:spring-cloud-starter-netflix-eureka-client&#x27;</span></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>as you can see at there, You should know the name of repositories for Spring Cloud is ‘<a target="_blank" rel="noopener" href="https://repo.spring.io/milestone">https://repo.spring.io/milestone</a>‘.</p>
<p>It’s not default repository, so You have add the repository when you add Spring Cloud.</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://example.com/2021/11/13/2021-11-13-spring-msa/" data-id="cl2h1m1mz00ppf0wb665e8af0" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "John Doe"
        },
        "headline": "Microservice Architecture of Spring",
        "image": "http://example.com/res/2021-11-13-spring-msa/1.png",
        "keywords": "Spring",
        "genre": "3. Kakaobank Spring",
        "datePublished": "2021-11-13",
        "dateCreated": "2021-11-13",
        "dateModified": "2022-04-15",
        "url": "http://example.com/2021/11/13/2021-11-13-spring-msa/",
        "description": "TDD가 개발자에게 좋은 이유여러 이유가 있지만 가장 중요한 점은 TDD로 요구사항에 대해 더 깊이 있게 생각할 수 있다는 점입니다. 테스트 코드를 먼저 작성하면 특정 상황에서 코드가 어떻게 동작할지 생각하게 됩니다. 이런 과정에서 애매한 요구사항은 명확히 하고, 유효하지 않은 요구사항은 거부할 수 있습니다.
곱셈 하는 예제 프로그램을 만들어 보자12345",
        "wordCount": 14571
    }
</script>

</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>


    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="stack-overflow" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-stack-overflow"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2021/11/15/2021-11-18-exception-handling-in-stream/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Exception handling in stream
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2021/11/11/2021-11-11-configuration-properties/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">Configuration Properties</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/05/14/2022-05-14-docker-build/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/3-Kakaobank/Docker/">Docker</a></p>
                            <p class="item-title"><a href="/2022/05/14/2022-05-14-docker-build/" class="title">Docker build</a></p>
                            <p class="item-date"><time datetime="2022-05-14T02:38:54.000Z" itemprop="datePublished">2022-05-14</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/05/14/2022-05-14-docker-compose/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/3-Kakaobank/Docker/">Docker</a></p>
                            <p class="item-title"><a href="/2022/05/14/2022-05-14-docker-compose/" class="title">Docker Compose commands</a></p>
                            <p class="item-date"><time datetime="2022-05-14T02:38:54.000Z" itemprop="datePublished">2022-05-14</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/05/14/2022-05-14-how-to-configure-to-record-youtube-in-ableton/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/3-Kakaobank/Ableton/">Ableton</a></p>
                            <p class="item-title"><a href="/2022/05/14/2022-05-14-how-to-configure-to-record-youtube-in-ableton/" class="title">How to configure to record youtube sound in ableton 10</a></p>
                            <p class="item-date"><time datetime="2022-05-14T02:38:54.000Z" itemprop="datePublished">2022-05-14</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/05/12/2022-05-12-kotlin-dslmarker/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/3-Kakaobank/Kotlin/">Kotlin</a></p>
                            <p class="item-title"><a href="/2022/05/12/2022-05-12-kotlin-dslmarker/" class="title">Kotlin dsl marker</a></p>
                            <p class="item-date"><time datetime="2022-05-12T02:38:54.000Z" itemprop="datePublished">2022-05-12</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2022/05/12/2022-05-12-enum-inheritance/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/3-Kakaobank/Java/">Java</a></p>
                            <p class="item-title"><a href="/2022/05/12/2022-05-12-enum-inheritance/" class="title">About java enum inheritance</a></p>
                            <p class="item-date"><time datetime="2022-05-12T02:38:54.000Z" itemprop="datePublished">2022-05-12</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/1-Student/">1. Student</a><span class="category-list-count">51</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/1-Student/Algorithm/">Algorithm</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/1-Student/Blog/">Blog</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/1-Student/Machine-learning/">Machine learning</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/1-Student/Project/">Project</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/1-Student/React/">React</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/">2. Interpark</a><span class="category-list-count">108</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Algorithm/">Algorithm</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Blog/">Blog</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Cloud/">Cloud</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Computer-Science/">Computer Science</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Container/">Container</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Css/">Css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Database/">Database</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Git/">Git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Java/">Java</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Maven/">Maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Network/">Network</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/React/">React</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Spring/">Spring</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/2-Interpark/Typescript/">Typescript</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/">3. Kakaobank</a><span class="category-list-count">62</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/AWS/">AWS</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Ableton/">Ableton</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Blog/">Blog</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Database/">Database</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Docker/">Docker</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Facade/">Facade</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Flutter/">Flutter</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Git/">Git</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Gradle/">Gradle</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/JUnit/">JUnit</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Java/">Java</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Javascript/">Javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Kotlin/">Kotlin</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Monitoring/">Monitoring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/RabbitMQ/">RabbitMQ</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Redis/">Redis</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Spring/">Spring</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Vue/">Vue</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/3-Kakaobank/Webflux/">Webflux</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/4-Unfinished/">4. Unfinished</a><span class="category-list-count">9</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">6</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/" rel="tag">AOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/" rel="tag">AWS</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ableton/" rel="tag">Ableton</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a><span class="tag-list-count">27</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/" rel="tag">Android</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BackboneJS/" rel="tag">BackboneJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blog/" rel="tag">Blog</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Brew/" rel="tag">Brew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/" rel="tag">Cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloud/" rel="tag">Cloud</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Computer-Science/" rel="tag">Computer Science</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Container/" rel="tag">Container</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Controller/" rel="tag">Controller</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Css/" rel="tag">Css</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DI/" rel="tag">DI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/" rel="tag">Database</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Pattern/" rel="tag">Design Pattern</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dto/" rel="tag">Dto</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Excel/" rel="tag">Excel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Facade/" rel="tag">Facade</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/" rel="tag">Flutter</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/" rel="tag">Gradle</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Graphql/" rel="tag">Graphql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Html/" rel="tag">Html</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Intellij/" rel="tag">Intellij</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ionic/" rel="tag">Ionic</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JQuery/" rel="tag">JQuery</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JUnit/" rel="tag">JUnit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jackson/" rel="tag">Jackson</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">49</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/" rel="tag">Javascript</a><span class="tag-list-count">14</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jekyll/" rel="tag">Jekyll</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jira/" rel="tag">Jira</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jmeter/" rel="tag">Jmeter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jpa/" rel="tag">Jpa</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Json/" rel="tag">Json</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jwt/" rel="tag">Jwt</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kiba/" rel="tag">Kiba</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lombok/" rel="tag">Lombok</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mac/" rel="tag">Mac</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Machine-learning/" rel="tag">Machine learning</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/" rel="tag">Maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Memory/" rel="tag">Memory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monitoring/" rel="tag">Monitoring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mybatis/" rel="tag">Mybatis</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Network/" rel="tag">Network</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Node/" rel="tag">Node</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/O-O-P/" rel="tag">O.O.P</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Object/" rel="tag">Object</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle/" rel="tag">Oracle</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Php/" rel="tag">Php</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgresql/" rel="tag">Postgresql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Reflect/" rel="tag">Reflect</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Regression/" rel="tag">Regression</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rest/" rel="tag">Rest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Roofline/" rel="tag">Roofline</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STT/" rel="tag">STT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Security/" rel="tag">Security</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sentry/" rel="tag">Sentry</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a><span class="tag-list-count">56</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swagger/" rel="tag">Swagger</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Telnet/" rel="tag">Telnet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Test/" rel="tag">Test</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Typescript/" rel="tag">Typescript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UnderscoreJS/" rel="tag">UnderscoreJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web/" rel="tag">Web</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webapp/" rel="tag">Webapp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webflux/" rel="tag">Webflux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xml/" rel="tag">Xml</a><span class="tag-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/AOP/" style="font-size: 10px;">AOP</a> <a href="/tags/AWS/" style="font-size: 16.15px;">AWS</a> <a href="/tags/Ableton/" style="font-size: 10px;">Ableton</a> <a href="/tags/Algorithm/" style="font-size: 18.46px;">Algorithm</a> <a href="/tags/Android/" style="font-size: 10.77px;">Android</a> <a href="/tags/BackboneJS/" style="font-size: 10px;">BackboneJS</a> <a href="/tags/Blog/" style="font-size: 13.85px;">Blog</a> <a href="/tags/Brew/" style="font-size: 10px;">Brew</a> <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/Cloud/" style="font-size: 13.08px;">Cloud</a> <a href="/tags/Computer-Science/" style="font-size: 14.62px;">Computer Science</a> <a href="/tags/Container/" style="font-size: 10.77px;">Container</a> <a href="/tags/Controller/" style="font-size: 10.77px;">Controller</a> <a href="/tags/Css/" style="font-size: 12.31px;">Css</a> <a href="/tags/DI/" style="font-size: 10px;">DI</a> <a href="/tags/Database/" style="font-size: 15.38px;">Database</a> <a href="/tags/Design-Pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/Docker/" style="font-size: 12.31px;">Docker</a> <a href="/tags/Dto/" style="font-size: 10px;">Dto</a> <a href="/tags/ElasticSearch/" style="font-size: 12.31px;">ElasticSearch</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/Facade/" style="font-size: 10px;">Facade</a> <a href="/tags/Flutter/" style="font-size: 12.31px;">Flutter</a> <a href="/tags/Git/" style="font-size: 13.08px;">Git</a> <a href="/tags/Gradle/" style="font-size: 13.08px;">Gradle</a> <a href="/tags/Graphql/" style="font-size: 10px;">Graphql</a> <a href="/tags/Hexo/" style="font-size: 11.54px;">Hexo</a> <a href="/tags/Html/" style="font-size: 10px;">Html</a> <a href="/tags/Intellij/" style="font-size: 10px;">Intellij</a> <a href="/tags/Ionic/" style="font-size: 10px;">Ionic</a> <a href="/tags/JQuery/" style="font-size: 10px;">JQuery</a> <a href="/tags/JUnit/" style="font-size: 10px;">JUnit</a> <a href="/tags/Jackson/" style="font-size: 10px;">Jackson</a> <a href="/tags/Java/" style="font-size: 19.23px;">Java</a> <a href="/tags/Javascript/" style="font-size: 17.69px;">Javascript</a> <a href="/tags/Jekyll/" style="font-size: 12.31px;">Jekyll</a> <a href="/tags/Jira/" style="font-size: 10px;">Jira</a> <a href="/tags/Jmeter/" style="font-size: 10px;">Jmeter</a> <a href="/tags/Jpa/" style="font-size: 10px;">Jpa</a> <a href="/tags/Json/" style="font-size: 10px;">Json</a> <a href="/tags/Jwt/" style="font-size: 10px;">Jwt</a> <a href="/tags/Kiba/" style="font-size: 10px;">Kiba</a> <a href="/tags/Kotlin/" style="font-size: 11.54px;">Kotlin</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Lombok/" style="font-size: 10.77px;">Lombok</a> <a href="/tags/Mac/" style="font-size: 10px;">Mac</a> <a href="/tags/Machine-learning/" style="font-size: 16.92px;">Machine learning</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/Memory/" style="font-size: 10px;">Memory</a> <a href="/tags/Monitoring/" style="font-size: 10px;">Monitoring</a> <a href="/tags/Mybatis/" style="font-size: 11.54px;">Mybatis</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Network/" style="font-size: 13.85px;">Network</a> <a href="/tags/Node/" style="font-size: 11.54px;">Node</a> <a href="/tags/O-O-P/" style="font-size: 10px;">O.O.P</a> <a href="/tags/Object/" style="font-size: 10px;">Object</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/Php/" style="font-size: 12.31px;">Php</a> <a href="/tags/Postgresql/" style="font-size: 10px;">Postgresql</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/React/" style="font-size: 14.62px;">React</a> <a href="/tags/Redis/" style="font-size: 13.08px;">Redis</a> <a href="/tags/Reflect/" style="font-size: 10px;">Reflect</a> <a href="/tags/Regression/" style="font-size: 10px;">Regression</a> <a href="/tags/Rest/" style="font-size: 10px;">Rest</a> <a href="/tags/Roofline/" style="font-size: 10px;">Roofline</a> <a href="/tags/STT/" style="font-size: 10px;">STT</a> <a href="/tags/Security/" style="font-size: 10.77px;">Security</a> <a href="/tags/Sentry/" style="font-size: 10px;">Sentry</a> <a href="/tags/Spring/" style="font-size: 20px;">Spring</a> <a href="/tags/Swagger/" style="font-size: 10px;">Swagger</a> <a href="/tags/Telnet/" style="font-size: 10px;">Telnet</a> <a href="/tags/Test/" style="font-size: 15.38px;">Test</a> <a href="/tags/Typescript/" style="font-size: 10px;">Typescript</a> <a href="/tags/UnderscoreJS/" style="font-size: 10px;">UnderscoreJS</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/Web/" style="font-size: 10.77px;">Web</a> <a href="/tags/Webapp/" style="font-size: 10px;">Webapp</a> <a href="/tags/Webflux/" style="font-size: 10.77px;">Webflux</a> <a href="/tags/Webpack/" style="font-size: 10.77px;">Webpack</a> <a href="/tags/Xml/" style="font-size: 10.77px;">Xml</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2022 John Doe</p>
                
                <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="https://github.com/ppoffice" target="_blank">PPOffice</a></p>
                
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

    </div>
    
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'http://example.com/2021/11/13/2021-11-13-spring-msa/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>





    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    

    
    
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
